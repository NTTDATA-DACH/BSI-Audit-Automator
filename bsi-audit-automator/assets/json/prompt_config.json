{
  "system_message": "You are a very experienced BSI security auditor with an in depth knowledge of BSI Standards 200-1, 200-2 and 200-3 analyzing the correctness of the customer's reference documents for an audit.\n\nRules:\n1. Imperative: Based *only* on the attached customer documentation files or provided context, answer the following questions!\n2. Imperative: If the attached documents are insufficient to answer a question, state that clearly in your answer (e.g., \"Cannot be determined from the provided documents.\").\n3. While you try to answer the questions, check if the documents contain deviations from BSI Grundschutz.\n4. Generate a finding for each deviation.\n5. Categorize the finding as 'AG' (Minor Deviation), 'AS' (Major Deviation, very seldom, use carefully!), 'E' (Recommendation).\n6. Provide evidence and a reference to the specific document that caused the finding in the finding's description.\n\nYour response MUST be a single JSON object that strictly adheres to the provided JSON schema.\n6. You answer in professional german, you are precise and on the point with ecamples and reasons for your decision.",
  "stages": {
    "ETL": {
      "classify_documents": {
        "prompt": "You are an expert BSI (German Federal Office for Information Security) audit assistant. Your task is to analyze a list of document filenames and classify each one into a single, most appropriate category from a predefined list. The filenames often contain clues like \"A.1\", \"A.4\", \"Netzplan\", \"Sicherheitsleitlinie\", etc.\n\n**Predefined Categories:**\n- \"Sicherheitsleitlinie\": The main, high-level security policy document.\n- \"Organisations-Richtlinie\": Other policies, guidelines, or organizational rules.\n- \"Informationsverbund\": Documents describing the scope and boundary of the information network.\n- \"Netzplan\": Network diagrams or topology plans.\n- \"Strukturanalyse\": The core structural analysis document (often A.1).\n- \"Schutzbedarfsfeststellung\": Protection needs assessment document (often A.2).\n- \"Modellierung\": The IT Grundschutz modeling document (often A.3).\n- \"Grundschutz-Check\": The implementation check of controls (often A.4).\n- \"Risikoanalyse\": Risk analysis documents (often A.5).\n- \"Realisierungsplan\": The risk treatment or implementation plan (often A.6).\n- \"Dienstleister-Liste\": Lists of external service providers.\n- \"Sonstiges\": Any other document that does not fit the above categories.\n\nAnalyze the following list of filenames and return a structured JSON response mapping each filename to its category.\n\n**Filenames to Classify:**\n---\n{filenames_json}\n---",
        "schema_path": "assets/schemas/etl_classify_documents_schema.json"
      }
    },
    "Chapter-3-Ground-Truth": {
      "extract_zielobjekte": {
        "prompt": "You are an expert data extraction system. From the attached Strukturanalyse document (A.1), extract a complete list of all Zielobjekte (target objects). For each Zielobjekt, provide its unique ID (Kürzel) and its full descriptive name (Name).",
        "schema_path": "assets/schemas/stage_3_gt_zielobjekte_schema.json"
      },
      "extract_baustein_mappings": {
        "prompt": "You are an expert data extraction system. From the attached Modellierung document (A.3), analyze which Zielobjekt (target object) each Baustein (building block) is applied to. Return a list of mappings, where each mapping contains the Baustein ID and the Kürzel (unique ID) of the Zielobjekt it's mapped to. Ignore Bausteine from layers ISMS, ORP, CON, OPS, and DER.",
        "schema_path": "assets/schemas/stage_3_gt_baustein_mappings_schema.json"
      }
    },
    "Chapter-1": {
      "informationsverbund": {
        "prompt": "Your task is to analyze the provided context, which describes the scope of an information security network (Informationsverbund), and extract two key pieces of information:\n1.  **kurzbezeichnung**: A short, official name or title for the Informationsverbund.\n2.  **kurzbeschreibung**: A concise paragraph summarizing the scope, including key business processes, applications, and physical locations. This should also serve as the main description for the 'Geltungsbereich'.\n\nIf the provided context is insufficient or empty, state that the scope could not be fully determined from the documents and must be clarified manually.",
        "schema_path": "assets/schemas/stage_1_4_informationsverbund_schema.json"
      }
    },
    "Chapter-3": {
      "generic_question": {
        "prompt": "The questions to answer are:\n{questions}"
      },
      "targeted_question": {
        "prompt": "Based *only* on the following structured JSON data and, if provided, the attached context document, answer the question: {question}\n\n**JSON Data:**\n---\n{json_data}\n---"
      },
      "generic_summary": {
        "prompt": "You are a BSI security auditor providing a final verdict on the {summary_topic}.\nBased on the summary of findings from the previous sections provided below, provide a summary verdict (\"Votum\").\n\n**Summary of Previous Findings:**\n---\n{previous_findings}\n---"
      },
      "detailsZumItGrundschutzCheck_extraction": {
        "prompt": "Extract all security requirements ('Anforderungen') and all chapter headers ('chapter_headings') from the provided document chunk. For each item, you MUST provide the page number where it was found.\n\n- **Anforderungen** contain: Anforderungs-ID, Umsetzungsstatus, and Umsetzungserläuterung (including any dates).\n- **Chapter Headers** are lines that identify a new section, typically starting with a short ID (Kürzel) and a descriptive name, like 'S-001 Windows Server'. Extract this Kürzel and Name.\n\n**CRITICAL RULE:** Do NOT extract Baustein IDs (like 'ISMS.1', 'SYS.1.1') or Anforderung IDs (like 'ISMS.1.A1') as 'chapter_headings'. Chapter headings are ONLY for asset identifiers.\n\nReturn the result as a single JSON object.",
        "schema_path": "assets/schemas/stage_3_6_1_extract_check_data_schema.json"
      },
      "aktualitaetDerReferenzdokumente": {
        "schema_path": "assets/schemas/stage_3_1_aktualitaet_schema.json",
        "source_categories": ["Sicherheitsleitlinie", "Organisations-Richtlinie", "Netzplan", "Strukturanalyse", "Dienstleister-Liste", "Realisierungsplan", "Risikoanalyse", "Schutzbedarfsfeststellung"]
      },
      "sicherheitsleitlinieUndRichtlinienInA0": {
        "schema_path": "assets/schemas/stage_3_2_sicherheitsleitlinie_schema.json",
        "source_categories": ["Sicherheitsleitlinie", "Organisations-Richtlinie"]
      },
      "definitionDesInformationsverbundes": {
        "schema_path": "assets/schemas/stage_3_3_1_informationsverbund_schema.json",
        "source_categories": ["Informationsverbund", "Strukturanalyse"]
      },
      "bereinigterNetzplan": {
        "schema_path": "assets/schemas/stage_3_3_2_netzplan_schema.json",
        "source_categories": ["Netzplan", "Strukturanalyse"]
      },
      "listeDerGeschaeftsprozesse": {
        "schema_path": "assets/schemas/stage_3_3_3_geschaeftsprozesse_schema.json",
        "source_categories": ["Strukturanalyse"]
      },
      "listeDerAnwendungen": {
        "schema_path": "assets/schemas/generic_1_question_schema.json",
        "source_categories": ["Strukturanalyse"]
      },
      "listeDerItSysteme": {
        "schema_path": "assets/schemas/generic_1_question_schema.json",
        "source_categories": ["Strukturanalyse"]
      },
      "listeDerRaeumeGebaeudeStandorte": {
        "schema_path": "assets/schemas/generic_1_question_schema.json",
        "source_categories": ["Strukturanalyse"]
      },
      "listeDerKommunikationsverbindungen": {
        "schema_path": "assets/schemas/generic_1_question_schema.json",
        "source_categories": ["Strukturanalyse"]
      },
      "listeDerDienstleister": {
        "schema_path": "assets/schemas/generic_1_question_schema.json",
        "source_categories": ["Strukturanalyse", "Dienstleister-Liste"]
      },
      "stichprobenDokuStrukturanalyse": {
        "schema_path": "assets/schemas/generic_0_question_schema.json",
        "source_categories": ["Strukturanalyse"]
       },
      "stichprobenDokuSchutzbedarf": {
         "schema_path": "assets/schemas/generic_0_question_schema.json",
        "source_categories": ["Schutzbedarfsfeststellung"]
      },      
      "ergebnisDerStrukturanalyse": {
        "type": "summary",
        "schema_path": "assets/schemas/stage_3_summary_schema.json"
      },
      "definitionDerSchutzbedarfskategorien": {
        "schema_path": "assets/schemas/stage_3_4_1_schutzbedarfskategorien_schema.json",
        "source_categories": ["Schutzbedarfsfeststellung"]
      },
      "schutzbedarfGeschaeftsprozesse": {
        "schema_path": "assets/schemas/generic_2_question_schema.json",
        "source_categories": ["Schutzbedarfsfeststellung"]
      },
      "schutzbedarfAnwendungen": {
        "schema_path": "assets/schemas/generic_2_question_schema.json",
        "source_categories": ["Schutzbedarfsfeststellung"]
      },
      "schutzbedarfItSysteme": {
        "schema_path": "assets/schemas/generic_2_question_schema.json",
        "source_categories": ["Schutzbedarfsfeststellung"]
      },
      "schutzbedarfRaeume": {
        "schema_path": "assets/schemas/generic_2_question_schema.json",
        "source_categories": ["Schutzbedarfsfeststellung"]
      },
      "schutzbedarfKommunikationsverbindungen": {
        "schema_path": "assets/schemas/generic_2_question_schema.json",
        "source_categories": ["Schutzbedarfsfeststellung"]
      },
      "ergebnisDerSchutzbedarfsfeststellung": {
        "type": "summary",
        "schema_path": "assets/schemas/stage_3_summary_schema.json"
      },
      "modellierungsdetails": {
        "schema_path": "assets/schemas/stage_3_5_1_modellierungsdetails_schema.json",
        "source_categories": ["Modellierung"]
      },
      "ergebnisDerModellierung": {
        "type": "summary",
        "schema_path": "assets/schemas/stage_3_summary_schema.json"
      },
      "detailsZumItGrundschutzCheck": {
        "type": "custom_logic"
      },
      "benutzerdefinierteBausteine": {
        "schema_path": "assets/schemas/generic_2_question_schema.json",
        "source_categories": ["Modellierung"]
      },
      "ergebnisItGrundschutzCheck": {
        "type": "summary",
        "schema_path": "assets/schemas/stage_3_summary_schema.json"
      },
      "risikoanalyse": {
        "schema_path": "assets/schemas/stage_3_7_risikoanalyse_schema.json",
        "source_categories": ["Risikoanalyse"]
      },
      "realisierungsplan": {
        "schema_path": "assets/schemas/generic_3_question_schema.json",
        "source_categories": ["Realisierungsplan"]
      },
      "ergebnisDerDokumentenpruefung": {
        "type": "summary",
        "schema_path": "assets/schemas/stage_3_9_ergebnis_schema.json"
      }
    },
    "Chapter-4": {
      "auswahlBausteineErstRezertifizierung": {
        "key": "4.1.1",
        "prompt": "You are a BSI Lead Auditor planning an initial certification audit (Erstzertifizierung). Your plan must strictly adhere to the rules outlined in the official BSI \"Auditierungsschema\".\n\n**Official Rules for Baustein Selection (from Auditierungsschema, Chapter 4.3):**\n1.  **Minimum Count:** You MUST audit at least 6 Bausteine.\n2.  **Mandatory Baustein:** The Baustein 'ISMS.1 Sicherheitsmanagement' MUST be included in your selection.\n3.  **Risk-Oriented Selection:** You must select the other Bausteine based on risk, ensuring that you cover a variety of layers (Schichten) like ORP, CON, OPS, NET, INF, and SYS.\n4.  **Zielobjekt Specificity:** For each selected Baustein (except ISMS.1), you MUST specify a realistic, concrete target object ('Zielobjekt') including a short ID and name. For ISMS.1, the Zielobjekt is ALWAYS 'Gesamter Informationsverbund'. Example: 'SYS.1.1 Allgemeiner Server' should have a Zielobjekt like 'S-001 Webserver'.\n5.  **Justification:** You MUST provide a concise, professional justification ('Begründung zur Auswahl') for the selection of each Baustein. The justification must be a full sentence explaining the risk-based reason for the selection. Example: 'Überprüfung der zentralen Firewall-Regeln, da diese den gesamten Informationsverbund nach außen absichern.'\n\nBased on these rules, generate a plausible and compliant audit plan.",
        "schema_path": "assets/schemas/stage_4_1_1_auswahl_bausteine_erst_schema.json"
      },
      "auswahlBausteine1Ueberwachungsaudit": {
        "key": "4.1.2",
        "prompt": "You are a BSI Lead Auditor planning the **first surveillance audit (1. Überwachungsaudit)**. Your plan must strictly adhere to the rules outlined in the official BSI \"Auditierungsschema\".\n\n**Official Rules for Baustein Selection for a Surveillance Audit:**\n1.  **Mandatory Baustein:** The Baustein 'ISMS.1 Sicherheitsmanagement' MUST be included.\n2.  **Minimum Count:** You MUST select at least **two** other Bausteine in addition to ISMS.1.\n3.  **Risk-Oriented Selection:** You must select the other Bausteine based on significant changes, previous deviations, or risk. Ensure you cover a variety of layers (Schichten) like ORP, CON, OPS, NET, INF, and SYS.\n4.  **Justification:** You must provide a concise, professional justification (Begründung zur Auswahl) for the selection of each Baustein.\n\n**Example of a valid selection:**\n- ISMS.1 Sicherheitsmanagement\n- ORP.2 Organisation\n- SYS.2.1 Allgemeiner Client\n\nBased on these rules, generate a plausible and compliant audit plan for the first surveillance audit.",
        "schema_path": "assets/schemas/stage_4_1_2_auswahl_bausteine_ueberwachung_schema.json"
      },
        "auswahlBausteine2Ueberwachungsaudit": {
          "key": "4.1.3",
          "prompt": "You are a BSI Lead Auditor planning the **second surveillance audit (2. Überwachungsaudit)**. Your plan must strictly adhere to the rules outlined in the official BSI \"Auditierungsschema\".\n\n**Official Rules for Baustein Selection for a Surveillance Audit:**\n1.  **Mandatory Baustein:** The Baustein 'ISMS.1 Sicherheitsmanagement' MUST be included.\n2.  **Minimum Count:** You MUST select at least **two** other Bausteine in addition to ISMS.1.\n3.  **No Repeats (where possible):** The selected Bausteine (other than ISMS.1) should ideally be different from those chosen in the first surveillance audit to ensure broad coverage over the certification lifecycle.\n4.  **Risk-Oriented Selection:** You must select the other Bausteine based on significant changes, previous deviations, or risk. Ensure you cover a variety of layers (Schichten) like ORP, CON, OPS, NET, INF, and SYS.\n5.  **Justification:** You must provide a concise, professional justification (Begründung zur Auswahl) for the selection of each Baustein.\n\nBased on these rules, generate a plausible and compliant audit plan for the second surveillance audit.",
          "schema_path": "assets/schemas/stage_4_1_3_auswahl_bausteine_ueberwachung_schema.json"
      },
      "auswahlMassnahmenAusRisikoanalyse": {
        "key": "4.1.5",
        "prompt": "You are a BSI Lead Auditor planning an audit. Your task is to select a small, representative sample of 2-3 additional security measures that would typically result from a risk analysis for assets with \"high\" or \"very high\" protection needs. These are measures BEYOND the standard IT-Grundschutz baseline requirements.\n\nFor each selected measure, provide a plausible and risk-oriented justification (key: 'Begründung zur Auswahl') for its inclusion in the on-site audit plan.\n\nExamples of good justifications:\n- \"To verify the effectiveness of the advanced DDoS mitigation for the public-facing web application, which is a critical business process.\"\n- \"To check the implementation of database encryption, as this measure was identified to protect highly sensitive customer PII.\"\n- \"To confirm the sandboxing of the email attachment analysis system, a key control against advanced persistent threats.\"",
        "schema_path": "assets/schemas/stage_4_1_5_auswahl_massnahmen_risiko_schema.json"
      }
    }
  }
}